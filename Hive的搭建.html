<p><span style="font-size: 18px;">本博客主要介绍Hive和MySql的搭建：&nbsp;　　</span></p>
<p><span style="font-size: 16px;">　　学习视频一天就讲完了，我看完了自己搭建MySql遇到了一堆坑，然后花了快两天才解决完，终于把MySql搭建好了。然后又去搭建Hive，又遇到了很多坑，就这样一直解决问题，加上网上搜索和个人排查检查日志。搜索百度，百度不行搜索Bing，看了csdn，看strackflow，最后终于功夫不负有心人，成功把MySql和Hive跑起来了。这里我将还原最初状态，并把遇到的坑一并记录下，同时防止后人采坑。</span></p>
<p><span style="font-size: 16px;">　　<strong>搭建环境：</strong></span></p>
<p><span style="font-size: 16px;">　　</span>Centos7，MySql14.14，Hive2.3.6　　</p>
<p><span style="font-size: 16px;">　<strong>　搭建MySql：</strong></span></p>
<p><span style="font-size: 16px;">　　</span>搭建步骤我参考的菜鸟教程<span style="font-size: 16px;">：&nbsp;<a href="https://www.runoob.com/mysql/mysql-install.html" target="_blank">https://www.runoob.com/mysql/mysql-install.html</a></span></p>
<p><span style="font-size: 16px;">　　</span>参考上述步骤搭建遇到的坑：</p>
<p><span style="font-size: 16px;">　　</span>坑1：安装完后，给root用户设置密码后，使用账户和密码登陆报了ERROR 1045 (28000): Access denied for user 'root'@'localhost' (using password: YES)错误，解决方案<a href="https://www.cnblogs.com/shun7man/p/11823120.html" target="_blank">点击</a>。</p>
<p><span style="font-size: 16px;">　<strong>　搭建Hive：</strong></span></p>
<p>　　搭建步骤我参考的：&nbsp;<a href="https://www.cnblogs.com/dxxblog/p/8193967.html" target="_blank">https://www.cnblogs.com/dxxblog/p/8193967.html</a></p>
<p>　　参考上述步骤遇到的坑：启动hive抛出Relative path in absolute URI: ${system:java.io.tmpdir%7D/$%7Bsystem:user.name%7D异常，解决方案<a href="https://www.cnblogs.com/shun7man/p/11823828.html" target="_blank">点击</a>。</p>
<p>　　<strong><span style="font-size: 18px;">操作Hive：</span></strong></p>
<p>&nbsp;　&nbsp; 先说下环境的坑：</p>
<p>　　坑1：当我在Hive中执行查询操作没问题，但是当删除表结构的时候会抛出如下异常 ：</p>
<p>　　执行drop table tableName;</p>
<p>　　Execution Error, return code 1 from org.apache.hadoop.hive.ql.exec.DDLTask. MetaException(message:For direct MetaStore DB connections, we don't support retries at the client level.)<br />　　这句话的意思是不支持此操作，并不是SQL写错了。 这个问题的原因是之前我们在hive的lib中添加的mysql-connection-java.jar（使用JDBC操作MySql的包）版本不对，我之前用的mysql-connection-java-5.1.18.jar，后来改为了mysql-connection-java-5.1.47.jar就好了。</p>
<p>　　如果您的也不对，请及时替换，<a href="https://pan.baidu.com/s/1wq0ttArB1oG8OOGnoDhQJQ" target="_blank">包连接</a></p>
<p>　　<span style="color: #0000ff;">案例1(在Hive中创建内部表)：</span></p>
<p>　　在Linux系统找个位置创建visits.txt和visits.hive文件：</p>
<p>　　在visits.txt文件里面加入如下内容，中间是以\t 分割的　　</p>
<div class="cnblogs_code">
<pre>一明 <span style="color: #800080;">18701223481</span><span style="color: #000000;"> 北京市朝阳区
毒逆天 </span><span style="color: #800080;">18498778212</span><span style="color: #000000;"> 江苏省苏州市
海面贝贝 </span><span style="color: #800080;">15099334981</span> 上海市闵行区</pre>
</div>
<p>　　在visits.hive加入创建数据库命令　　</p>
<div class="cnblogs_code">
<pre><span style="color: #000000;">create table people_visits
(
user_name </span><span style="color: #0000ff;">string</span><span style="color: #000000;">,
phone </span><span style="color: #0000ff;">string</span><span style="color: #000000;">,
address </span><span style="color: #0000ff;">string</span><span style="color: #000000;">
)
row format delimited
fields terminated by </span><span style="color: #800000;">'</span><span style="color: #800000;">\t</span><span style="color: #800000;">'</span>;</pre>
</div>
<p>　　&nbsp;在hive里面创建people_visits表</p>
<div class="cnblogs_code">
<pre> hive -f  visits.hive</pre>
</div>
<p>&nbsp;　　&nbsp;然后在hive中使用show tables; 就能看到这个表了。 但是数据是空的。接下来使用命令将visits.txt文件数据提交到hdfs再查询就能看到数据了。</p>
<div class="cnblogs_code">
<pre>hadoop fs -put visits.txt   /user/hive/warehouse/people_visits</pre>
</div>
<p>&nbsp;<img src="https://img2018.cnblogs.com/i-beta/1747187/201911/1747187-20191110102839471-2127797323.png" alt="" /></p>
<p>&nbsp;　　使用web浏览也可以看到上传的文件：&nbsp;</p>
<p><img src="https://img2018.cnblogs.com/i-beta/1747187/201911/1747187-20191110103037919-1161073138.png" alt="" /></p>
<p>&nbsp;</p>
<p><span style="color: #0000ff;">&nbsp;　　案例2:(在hive中创建外部表)</span></p>
<p>&nbsp;　　在Linux本地找个文件夹创建externalHive.txt文件</p>
<div class="cnblogs_code">
<pre> cd /data/</pre>
</div>
<div class="cnblogs_code">
<pre><span style="color: #000000;"> touch externalHive.txt</span></pre>
</div>
<p>&nbsp;　　编辑文件加入以下内容</p>
<div class="cnblogs_code">
<pre>vim  externalHive.txt</pre>
</div>
<div class="cnblogs_code">
<pre>西红柿 <span style="color: #800080;">11</span><span style="color: #000000;">
桃子 </span><span style="color: #800080;">22</span></pre>
</div>
<p>&nbsp;&nbsp;　 注意:(上面字符使用tab键分割)</p>
<p>　　在hdfs里面新建一个hivetest文件夹</p>
<div class="cnblogs_code">
<pre>hadoop fs -mkdir /user/root/hivetest</pre>
</div>
<p>&nbsp;　　将文件上传到hdfs</p>
<div class="cnblogs_code">
<pre>hadoop fs -put externalHive.txt /user</pre>
</div>
<p>&nbsp;　　进入Hive创建一个价格外部表</p>
<div class="cnblogs_code">
<pre>hive</pre>
</div>
<div class="cnblogs_code">
<pre><span style="color: #000000;">create external table priceVisits
(
name </span><span style="color: #0000ff;">string</span><span style="color: #000000;">,
price </span><span style="color: #0000ff;">int</span><span style="color: #000000;">
) 
row format delimited
fields terminated by </span><span style="color: #800000;">'</span><span style="color: #800000;">\t</span><span style="color: #800000;">'</span><span style="color: #000000;">
location </span><span style="color: #800000;">'</span><span style="color: #800000;">/user/root/hivetest</span><span style="color: #800000;">'</span>;   --指定表所在路径</pre>
</div>
<p>&nbsp;　　将数据上传到priceVisits表里面</p>
<div class="cnblogs_code">
<pre>hive  </pre>
</div>
<div class="cnblogs_code">
<pre><span style="color: #000000;">load data inpath </span><span style="color: #800000;">'</span><span style="color: #800000;">/user/externalHive.txt</span><span style="color: #800000;">'</span> into table priceVisits;</pre>
</div>
<p>&nbsp;　　PS：(上面的命令执行完后，user目录下的externalHive.txt就会移动到创建table时指定的目录下面)</p>
<p>　　查询priceVisits表就可以看到数据了</p>
<div class="cnblogs_code">
<pre><span style="color: #0000ff;">select</span> *<span style="color: #0000ff;">from</span> priceVisits;</pre>
</div>
<p><img src="https://img2018.cnblogs.com/i-beta/1747187/201911/1747187-20191110111426270-1892983804.png" alt="" /></p>
<p>&nbsp;　　&nbsp;删除priceVisits表：</p>
<div class="cnblogs_code">
<pre>drop table priceVisits;</pre>
</div>
<p>&nbsp;　　&nbsp;可以看到表删除了，但是数据还没删除，这就是外部表的作用</p>
<p><img src="https://img2018.cnblogs.com/i-beta/1747187/201911/1747187-20191110111803643-351087078.png" alt="" /></p>
<p>&nbsp;&nbsp;<img src="https://img2018.cnblogs.com/i-beta/1747187/201911/1747187-20191110112134698-793970504.png" alt="" /></p>
<p><span style="color: #0000ff;">&nbsp;　　案例3:综合查询</span></p>
<p>&nbsp;　　上面的查询并没有用到MapReduce计算，仅仅使用了简单的本地查询，这是因为我们没有写聚合语句，不需要MapReduce。 接下来写个需要MapReduce的案例。</p>
<p>&nbsp;　　</p>
<p>&nbsp;</p>
<p>&nbsp;　&nbsp; &nbsp;<span style="color: #ff0000;">其它操作语句参考博客：&nbsp;<a href="https://blog.csdn.net/ddydavie/article/details/80667727#commentBox">https://blog.csdn.net/ddydavie/article/details/80667727#commentBox</a></span></p>
<p><span style="color: #ff0000;">　　分桶操作参考：&nbsp;<a href="https://blog.csdn.net/u010003835/article/details/80911215">https://blog.csdn.net/u010003835/article/details/80911215</a></span></p>
